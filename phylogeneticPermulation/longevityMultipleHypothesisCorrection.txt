# adjust p-value
results =read.csv(file="/projects/pfenninggroup/machineLearningForComputationalBiology/VocalLearningTACIT/data/superModelPredict/longevity/phylolmRes/longevity_initial_result_r1_s-292960981.csv")
bh = p.adjust(results$Pvalue, method = "BH")
results$bh = bh
write.csv(results, "/projects/pfenninggroup/machineLearningForComputationalBiology/VocalLearningTACIT/data/superModelPredict/longevity/phylolmRes/longevity_initial_result_r1_adjusted.csv", row.names = FALSE)

# generate permualtion file
awk '{OFS=","}{print $1 $2 $3 ,999}' longevity_initial_result_r1_s-292960981.csv > tmp.csv
tr -d '"' <tmp.csv > longevity_perm1_missingTr.csv

# generate permulation matrix
filterPeak=/projects/pfenninggroup/machineLearningForComputationalBiology/VocalLearningTACIT/code/d2_model_prediction/step7_filterPeakName.py

python $filterPeak --unfilteredPeakFileName predictionMatrix.csv --unfilteredPeakNameCol 0 --peakListFileName longevity_perm_1k_missingTr.csv --peakNameCol 0  --splitCharacterPeakList , --outputFileName permulation_1k_predictionMatrix.csv

# compute permulation p-value
python /projects/pfenninggroup/machineLearningForComputationalBiology/VocalLearningTACIT/code/TACIT/compute_perm_pvals_conditional.py phylolmRes/longevity_initial_result_r1_s-292960981.csv 1 permul1 longevity_perm_1k_computedP.csv

# adjust p-value


results =read.csv(file="/projects/pfenninggroup/machineLearningForComputationalBiology/VocalLearningTACIT/data/superModelPredict/longevity/permul1/analysis/longevity_perm_1k_computedP.csv")
bh = p.adjust(results$Exp_Pvalue, method = "bonferroni")
results$bh = bh
sorted <- results[order(results$bh),]
write.csv(sorted, "/projects/pfenninggroup/machineLearningForComputationalBiology/VocalLearningTACIT/data/superModelPredict/longevity/permul1/analysis/longevity_perm_1k_computedP_adjusted2.csv", row.names = FALSE)

# plot p distribution
library(ggplot2)
png("foobar.png")
hist(PlantGrowth$weight)
dev.off()

# permulation -2 

python $filterPeak --unfilteredPeakFileName predictionMatrix.csv --unfilteredPeakNameCol 0 --peakListFileName perm2.csv --peakNameCol 0  --splitCharacterPeakList , --outputFileName permulation_10k_predictionMatrix.csv

# compute permulation p-value
python /projects/pfenninggroup/machineLearningForComputationalBiology/VocalLearningTACIT/code/TACIT/compute_perm_pvals_conditional.py phylolmRes/longevity_initial_result_r1_s-292960981.csv 2 permul1 permul2 longevity_perm_10k_computedP.csv

awk -F "," '{print $1","$2","$3","90000}'

/projects/pfenninggroup/machineLearningForComputationalBiology/VocalLearningTACIT/data/superModelPredict/longevity/analysis/perm10k

python $filterPeak --unfilteredPeakFileName predictionMatrix.csv --unfilteredPeakNameCol 0 --peakListFileName analysis/perm10k/perm100k.csv --peakNameCol 0  --splitCharacterPeakList , --outputFileName permulation_100k_predictionMatrix.csv

# perm 100k

python /projects/pfenninggroup/machineLearningForComputationalBiology/VocalLearningTACIT/code/TACIT/compute_perm_pvals_conditional.py phylolmRes/longevity_initial_result_r1_s-292960981.csv 3 permul1 permul2 permul3 longevity_perm_100k_computedP.csv

awk -F "," '{print $1","$2","$3","900000}' sele

python $filterPeak --unfilteredPeakFileName predictionMatrix.csv --unfilteredPeakNameCol 0 --peakListFileName perm_1m.csv --peakNameCol 0  --splitCharacterPeakList , --outputFileName permulation_1m_predictionMatrix.csv

# perm 1m
python /projects/pfenninggroup/machineLearningForComputationalBiology/VocalLearningTACIT/code/TACIT/compute_perm_pvals_conditional.py phylolmRes/longevity_initial_result_r1_s-292960981.csv 4 permul1 permul2 permul3 permul4 longevity_perm_1m_computedP.csv


results =read.csv(file="/projects/pfenninggroup/machineLearningForComputationalBiology/VocalLearningTACIT/data/superModelPredict/longevity/analysis/perm1m/longevity_perm_1m_computedP.csv")
bh = p.adjust(results$Exp_Pvalue, method = "BH")
results$bh = bh
sorted <- results[order(results$bh),]
write.csv(sorted, "/projects/pfenninggroup/machineLearningForComputationalBiology/VocalLearningTACIT/data/superModelPredict/longevity/analysis/perm1m/longevity_perm_1m_adjusted.csv", row.names = FALSE)

results = read.csv(file="/projects/pfenninggroup/machineLearningForComputationalBiology/VocalLearningTACIT/data/superModelPredict/longevity/analysis/perm1m/longevity_perm_1m_computedP.csv")
library(qvalue)
qval <- qvalue(results$Pvalue)
results$qval<-qval$qvalues
sorted <- results[order(results$qval),]
write.csv(sorted, "/projects/pfenninggroup/machineLearningForComputationalBiology/VocalLearningTACIT/data/superModelPredict/longevity/analysis/perm1m/longevity_perm_1m_qvalue.csv", row.names = FALSE)